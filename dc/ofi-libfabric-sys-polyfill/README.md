# ofi-libfabric-sys-polyfill

UDP-based polyfill for `ofi-libfabric-sys` FFI bindings.

## Purpose

This crate provides a drop-in replacement for `ofi-libfabric-sys` that implements libfabric operations over UDP sockets instead of requiring actual RDMA hardware. It matches the FFI interface generated by bindgen from libfabric headers, allowing high-level Rust bindings to work unchanged.

## Features

- **FFI-compatible** - Provides the same `bindgen` module as `ofi-libfabric-sys`
- **No external dependencies** - Works on any platform without libfabric installed
- **Synthetic resource management** - Atomic counters generate unique keys and handles
- **C ABI compatible** - All structs use `#[repr(C)]` for binary compatibility

## Implementation

The polyfill provides:

- All libfabric types (`fi_info`, `fid_*`, etc.)
- All libfabric constants (capabilities, modes, protocols, etc.)
- All libfabric functions (`fi_*` C functions)
- Synthetic memory keys via atomic counters
- Synthetic address handles via atomic counters
- Stub implementations for data transfer operations (ready for UDP protocol integration)

## Usage

This crate is typically used via the `s2n-quic-dc` crate's feature flags:

```toml
# Use polyfill (no libfabric required)
s2n-quic-dc = { version = "*", default-features = true }

# Use real libfabric
s2n-quic-dc = { version = "*", features = ["libfabric"], default-features = false }
```

## Limitations

Current stub implementations for data transfer need full UDP protocol integration:
- `fi_sendv` - Send operation
- `fi_recv` - Receive operation  
- `fi_read` - RDMA read
- `fi_writev` - RDMA write

These return success but don't actually transfer data. Full implementation requires integration with the transport layer's message protocol (DATA_CHUNKS, READ_REQUEST/RESPONSE, WRITE_DATA messages described in V2.md).

## License

Apache-2.0
